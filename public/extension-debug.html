<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æµè§ˆå™¨æ‰©å±•è¯Šæ–­</title>
  <style>
    body {
      font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
      line-height: 1.6;
      color: #333;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      color: #2563eb;
      border-bottom: 2px solid #e5e7eb;
      padding-bottom: 10px;
    }
    h2 {
      color: #4b5563;
      margin-top: 30px;
    }
    .info-box {
      background-color: #f3f4f6;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }
    .info-item {
      margin-bottom: 8px;
    }
    .info-label {
      font-weight: bold;
      display: inline-block;
      width: 150px;
    }
    .extension-list {
      list-style-type: none;
      padding: 0;
    }
    .extension-item {
      padding: 8px 0;
      border-bottom: 1px solid #e5e7eb;
    }
    .button {
      background-color: #2563eb;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
    }
    .button:hover {
      background-color: #1d4ed8;
    }
    .result {
      margin-top: 15px;
      padding: 10px;
      border-radius: 4px;
      display: none;
    }
    .success {
      background-color: #d1fae5;
      border: 1px solid #34d399;
      color: #065f46;
    }
    .error {
      background-color: #fee2e2;
      border: 1px solid #f87171;
      color: #b91c1c;
    }
    .steps {
      background-color: #e0f2fe;
      border-radius: 8px;
      padding: 15px;
    }
    .step {
      margin-bottom: 15px;
    }
    .step-number {
      display: inline-block;
      width: 24px;
      height: 24px;
      background-color: #0ea5e9;
      color: white;
      border-radius: 50%;
      text-align: center;
      line-height: 24px;
      margin-right: 10px;
    }
    pre {
      background-color: #f8f9fa;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-family: monospace;
    }
    .tab {
      overflow: hidden;
      border: 1px solid #ccc;
      background-color: #f1f1f1;
      border-radius: 4px 4px 0 0;
    }
    .tab button {
      background-color: inherit;
      float: left;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 10px 16px;
      transition: 0.3s;
    }
    .tab button:hover {
      background-color: #ddd;
    }
    .tab button.active {
      background-color: #2563eb;
      color: white;
    }
    .tabcontent {
      display: none;
      padding: 15px;
      border: 1px solid #ccc;
      border-top: none;
      border-radius: 0 0 4px 4px;
    }
  </style>
  <script src="/extension-compat.js"></script>
</head>
<body>
  <h1>æµè§ˆå™¨æ‰©å±•è¯Šæ–­</h1>
  
  <div class="info-box">
    <h2>å½“å‰æµè§ˆå™¨ä¿¡æ¯</h2>
    <div class="info-item">
      <span class="info-label">æµè§ˆå™¨åç§°:</span>
      <span id="browser-name">æ£€æµ‹ä¸­...</span>
    </div>
    <div class="info-item">
      <span class="info-label">æµè§ˆå™¨ç‰ˆæœ¬:</span>
      <span id="browser-version">æ£€æµ‹ä¸­...</span>
    </div>
    <div class="info-item">
      <span class="info-label">æ“ä½œç³»ç»Ÿ:</span>
      <span id="os-info">æ£€æµ‹ä¸­...</span>
    </div>
    <div class="info-item">
      <span class="info-label">Cookie çŠ¶æ€:</span>
      <span id="cookie-enabled">æ£€æµ‹ä¸­...</span>
    </div>
  </div>

  <div class="tab">
    <button class="tablinks active" onclick="openTab(event, 'extensionTab')">æµè§ˆå™¨æ‰©å±•</button>
    <button class="tablinks" onclick="openTab(event, 'supabaseTab')">Supabaseæµ‹è¯•</button>
    <button class="tablinks" onclick="openTab(event, 'troubleshootTab')">æ•…éšœæ’é™¤</button>
  </div>

  <div id="extensionTab" class="tabcontent" style="display: block;">
    <h2>å¸¸è§å†²çªæ‰©å±•</h2>
    <p>ä»¥ä¸‹æ‰©å±•å¯èƒ½ä¼šå¹²æ‰°ç½‘ç«™çš„æ­£å¸¸è¿è¡Œï¼Œå°¤å…¶æ˜¯ç™»å½•åŠŸèƒ½ï¼š</p>
    <ul class="extension-list">
      <li class="extension-item">ğŸ¦Š MetaMask (åŠ å¯†é’±åŒ…)</li>
      <li class="extension-item">ğŸ›¡ï¸ AdBlock / AdBlock Plus (å¹¿å‘Šæ‹¦æˆªå™¨)</li>
      <li class="extension-item">ğŸ”’ Privacy Badger (éšç§ä¿æŠ¤)</li>
      <li class="extension-item">ğŸ” Grammarly (è¯­æ³•æ£€æŸ¥)</li>
      <li class="extension-item">ğŸŒ æµè§ˆå™¨ç¿»è¯‘æ‰©å±•</li>
      <li class="extension-item">ğŸ”’ å¯†ç ç®¡ç†å™¨ (LastPass, 1Passwordç­‰)</li>
      <li class="extension-item">ğŸ§¬ è„šæœ¬ç®¡ç†å™¨ (Tampermonkey, Greasemonkey)</li>
    </ul>
    
    <h2>æµè§ˆå™¨APIæµ‹è¯•</h2>
    <button id="test-extensions-btn" class="button">æµ‹è¯•æµè§ˆå™¨æ‰©å±•å†²çª</button>
    <div id="extension-test-result" class="result"></div>
  </div>

  <div id="supabaseTab" class="tabcontent">
    <h2>Supabase è¿æ¥æµ‹è¯•</h2>
    <p>æ­¤æµ‹è¯•å°†æ£€æŸ¥æ‚¨çš„æµè§ˆå™¨æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸è¿æ¥åˆ°SupabaseæœåŠ¡ã€‚</p>
    
    <div class="info-box">
      <div class="info-item">
        <span class="info-label">æµ‹è¯•URL:</span>
        <span id="supabase-url">https://wcjctczyzibrswwngmvd.supabase.co</span>
      </div>
    </div>
    
    <button id="test-supabase-network-btn" class="button">æµ‹è¯•ç½‘ç»œè¿æ¥</button>
    <button id="test-supabase-auth-btn" class="button">æµ‹è¯•ç™»å½•åŠŸèƒ½</button>
    <div id="supabase-test-result" class="result"></div>
    
    <div id="supabase-auth-form" style="display: none; margin-top: 20px;">
      <h3>æµ‹è¯•ç™»å½•</h3>
      <p>è¯·è¾“å…¥æ‚¨çš„ç™»å½•ä¿¡æ¯è¿›è¡Œæµ‹è¯•ï¼š</p>
      <div style="margin-bottom: 10px;">
        <label style="display: block; margin-bottom: 5px;">é‚®ç®±ï¼š</label>
        <input type="email" id="test-email" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc;">
      </div>
      <div style="margin-bottom: 10px;">
        <label style="display: block; margin-bottom: 5px;">å¯†ç ï¼š</label>
        <input type="password" id="test-password" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc;">
      </div>
      <button id="submit-login-test" class="button">æµ‹è¯•ç™»å½•</button>
    </div>
  </div>

  <div id="troubleshootTab" class="tabcontent">
    <h2>ç™»å½•é—®é¢˜æ’æŸ¥æ­¥éª¤</h2>
    
    <div class="steps">
      <div class="step">
        <span class="step-number">1</span>
        <strong>ä½¿ç”¨æ— ç—•æ¨¡å¼</strong>: æ‰“å¼€æµè§ˆå™¨çš„éšç§/æ— ç—•æ¨¡å¼å°è¯•ç™»å½•ã€‚è¿™ä¼šç¦ç”¨æ‰€æœ‰æ‰©å±•ï¼Œå¦‚æœèƒ½å¤Ÿç™»å½•æˆåŠŸï¼Œåˆ™é—®é¢˜å¯èƒ½æ˜¯æ‰©å±•å¼•èµ·çš„ã€‚
      </div>
      <div class="step">
        <span class="step-number">2</span>
        <strong>ç¦ç”¨æ‰©å±•</strong>: ä¸´æ—¶ç¦ç”¨æ‰€æœ‰æµè§ˆå™¨æ‰©å±•ï¼Œç‰¹åˆ«æ˜¯ä¸Šé¢åˆ—è¡¨ä¸­çš„æ‰©å±•ï¼Œç„¶åå°è¯•é‡æ–°ç™»å½•ã€‚
      </div>
      <div class="step">
        <span class="step-number">3</span>
        <strong>å°è¯•ä¸åŒæµè§ˆå™¨</strong>: ä½¿ç”¨å¦ä¸€ä¸ªæµè§ˆå™¨ï¼ˆå¦‚Firefoxã€Edgeæˆ–Safariï¼‰å°è¯•ç™»å½•ã€‚
      </div>
      <div class="step">
        <span class="step-number">4</span>
        <strong>æ¸…é™¤ç¼“å­˜å’ŒCookie</strong>: æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ã€Cookieå’Œæœ¬åœ°å­˜å‚¨æ•°æ®ï¼Œç„¶åé‡æ–°å°è¯•ã€‚
      </div>
      <div class="step">
        <span class="step-number">5</span>
        <strong>æ£€æŸ¥ç½‘ç»œè¿æ¥</strong>: ç¡®ä¿æ‚¨çš„ç½‘ç»œè¿æ¥ç¨³å®šï¼Œæ²¡æœ‰è¢«ä»£ç†æˆ–é˜²ç«å¢™é˜»æ­¢ã€‚
      </div>
      <div class="step">
        <span class="step-number">6</span>
        <strong>ç¡®è®¤è´¦æˆ·çŠ¶æ€</strong>: ç¡®è®¤æ‚¨çš„è´¦æˆ·æœªè¢«é”å®šæˆ–ç¦ç”¨ã€‚å¯ä»¥å°è¯•é‡ç½®å¯†ç æ¥éªŒè¯è´¦æˆ·çŠ¶æ€ã€‚
      </div>
    </div>
  </div>

  <script>
    // æµè§ˆå™¨ä¿¡æ¯æ£€æµ‹
    function detectBrowser() {
      const userAgent = navigator.userAgent;
      let browserName = "æœªçŸ¥";
      let browserVersion = "æœªçŸ¥";
      
      if (userAgent.indexOf("Chrome") > -1) {
        browserName = "Chrome";
        browserVersion = userAgent.match(/Chrome\/([0-9.]+)/)[1];
      } else if (userAgent.indexOf("Firefox") > -1) {
        browserName = "Firefox";
        browserVersion = userAgent.match(/Firefox\/([0-9.]+)/)[1];
      } else if (userAgent.indexOf("Safari") > -1 && userAgent.indexOf("Chrome") === -1) {
        browserName = "Safari";
        browserVersion = userAgent.match(/Version\/([0-9.]+)/)[1];
      } else if (userAgent.indexOf("Edge") > -1 || userAgent.indexOf("Edg") > -1) {
        browserName = "Edge";
        browserVersion = userAgent.match(/Edge\/([0-9.]+)/)?.[1] || userAgent.match(/Edg\/([0-9.]+)/)[1];
      }
      
      let osInfo = "æœªçŸ¥";
      if (userAgent.indexOf("Win") > -1) osInfo = "Windows";
      else if (userAgent.indexOf("Mac") > -1) osInfo = "macOS";
      else if (userAgent.indexOf("Linux") > -1) osInfo = "Linux";
      else if (userAgent.indexOf("Android") > -1) osInfo = "Android";
      else if (userAgent.indexOf("iPhone") > -1 || userAgent.indexOf("iPad") > -1) osInfo = "iOS";
      
      document.getElementById("browser-name").textContent = browserName;
      document.getElementById("browser-version").textContent = browserVersion;
      document.getElementById("os-info").textContent = osInfo;
      document.getElementById("cookie-enabled").textContent = navigator.cookieEnabled ? "å¯ç”¨" : "ç¦ç”¨";
    }
    
    // æµ‹è¯•æµè§ˆå™¨æ‰©å±•å†²çª
    document.getElementById("test-extensions-btn").addEventListener("click", function() {
      const resultElement = document.getElementById("extension-test-result");
      resultElement.style.display = "block";
      
      try {
        // æ£€æŸ¥æ˜¯å¦å­˜åœ¨å·²çŸ¥å¯èƒ½å†²çªçš„æ‰©å±•API
        const hasChrome = typeof chrome !== 'undefined';
        const hasBrowser = typeof browser !== 'undefined';
        const hasMetaMask = typeof window.ethereum !== 'undefined';
        
        // æµ‹è¯•åŸå‹é“¾æ˜¯å¦è¢«ä¿®æ”¹
        const hasModifiedPrototype = (function() {
          const originalToString = Object.prototype.toString;
          return Object.prototype.toString !== originalToString;
        })();
        
        // æµ‹è¯•Fetch APIæ˜¯å¦å¯ç”¨
        const fetchTest = fetch('https://www.google.com/favicon.ico')
          .then(() => true)
          .catch(() => false);
        
        // æµ‹è¯•localStorageè®¿é—®
        const storageTest = (function() {
          try {
            localStorage.setItem('test', 'test');
            localStorage.removeItem('test');
            return true;
          } catch (e) {
            return false;
          }
        })();
        
        // æµ‹è¯•ç»“æœ
        let issues = [];
        if (hasMetaMask) issues.push("æ£€æµ‹åˆ°MetaMaskåŠ å¯†é’±åŒ…");
        if (hasModifiedPrototype) issues.push("æ£€æµ‹åˆ°JavaScriptåŸå‹è¢«ä¿®æ”¹ï¼ˆå¯èƒ½æ˜¯MetaMaskçš„lockdownè„šæœ¬ï¼‰");
        if (!storageTest) issues.push("æµè§ˆå™¨é˜»æ­¢äº†localStorageçš„è®¿é—®");
        
        // æ˜¾ç¤ºç»“æœ
        resultElement.innerHTML = `
          <h3>æµ‹è¯•ç»“æœ:</h3>
          <div class="info-item"><span class="info-label">Chromeæ‰©å±•API:</span> ${hasChrome ? 'å¯ç”¨' : 'ä¸å¯ç”¨'}</div>
          <div class="info-item"><span class="info-label">Firefoxæ‰©å±•API:</span> ${hasBrowser ? 'å¯ç”¨' : 'ä¸å¯ç”¨'}</div>
          <div class="info-item"><span class="info-label">MetaMaské’±åŒ…:</span> ${hasMetaMask ? 'å·²æ£€æµ‹åˆ°' : 'æœªæ£€æµ‹åˆ°'}</div>
          <div class="info-item"><span class="info-label">JSåŸå‹ä¿®æ”¹:</span> ${hasModifiedPrototype ? 'å·²æ£€æµ‹åˆ°ä¿®æ”¹' : 'æœªæ£€æµ‹åˆ°ä¿®æ”¹'}</div>
          <div class="info-item"><span class="info-label">æœ¬åœ°å­˜å‚¨è®¿é—®:</span> ${storageTest ? 'æ­£å¸¸' : 'å—é™'}</div>
          ${issues.length > 0 ? '<h4>æ½œåœ¨é—®é¢˜:</h4><ul>' + issues.map(issue => `<li>${issue}</li>`).join('') + '</ul>' : '<p>æœªæ£€æµ‹åˆ°æ˜æ˜¾å†²çªã€‚</p>'}
        `;
        
        // æ ¹æ®æ˜¯å¦æœ‰é—®é¢˜è®¾ç½®æ ·å¼
        if (issues.length > 0) {
          resultElement.className = "result error";
        } else {
          resultElement.className = "result success";
        }
      } catch (error) {
        resultElement.className = "result error";
        resultElement.innerHTML = `<p>æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ${error.message}</p>`;
      }
    });
    
    // Supabaseç½‘ç»œè¿æ¥æµ‹è¯•
    document.getElementById("test-supabase-network-btn").addEventListener("click", function() {
      const resultElement = document.getElementById("supabase-test-result");
      resultElement.style.display = "block";
      resultElement.className = "result";
      resultElement.innerHTML = "<p>æ­£åœ¨æµ‹è¯•è¿æ¥åˆ°SupabaseæœåŠ¡...</p>";
      
      // æµ‹è¯•è¿æ¥åˆ°Supabase
      const startTime = performance.now();
      fetch('https://wcjctczyzibrswwngmvd.supabase.co/auth/v1/health', {
        method: 'GET',
        headers: { 'Content-Type': 'application/json' }
      })
      .then(response => {
        const endTime = performance.now();
        const responseTime = Math.round(endTime - startTime);
        
        if (response.ok) {
          return response.json().then(data => {
            resultElement.className = "result success";
            resultElement.innerHTML = `
              <h3>è¿æ¥æµ‹è¯•æˆåŠŸ!</h3>
              <p>SupabaseæœåŠ¡å¯ä»¥æ­£å¸¸è®¿é—®</p>
              <p>å“åº”æ—¶é—´: ${responseTime}ms</p>
              <p>æœåŠ¡çŠ¶æ€: ${data.status || 'OK'}</p>
            `;
          });
        } else {
          resultElement.className = "result error";
          resultElement.innerHTML = `
            <h3>è¿æ¥æµ‹è¯•å¤±è´¥</h3>
  
  <h2>å½“å‰æµè§ˆå™¨ä¿¡æ¯</h2>
  <div id="browser-info" class="info-box"></div>
  
  <h2>å·²å®‰è£…æ‰©å±•æ£€æµ‹</h2>
  <div class="info-box">
    ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥åˆ—å‡ºæ‚¨å®‰è£…çš„æ‰€æœ‰æ‰©å±•ã€‚ä½†ä»¥ä¸‹æ‰©å±•å¸¸è§å†²çªé—®é¢˜ï¼š
    <ul id="extension-list">
      <li class="extension-item">MetaMask (åŠ å¯†é’±åŒ…æ‰©å±•)</li>
      <li class="extension-item">AdBlock / AdBlock Plus / uBlock Origin (å¹¿å‘Šæ‹¦æˆªå™¨)</li>
      <li class="extension-item">Privacy Badger (éšç§ä¿æŠ¤æ‰©å±•)</li>
      <li class="extension-item">HTTPS Everywhere (HTTPSå¼ºåˆ¶æ‰©å±•)</li>
      <li class="extension-item">NoScript / ScriptSafe (è„šæœ¬æ‹¦æˆªæ‰©å±•)</li>
    </ul>
  </div>
  
  <h2>æµ‹è¯•é€šä¿¡</h2>
  <div class="info-box">
    <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æµ‹è¯•æµè§ˆå™¨APIé€šä¿¡æ˜¯å¦æ­£å¸¸ï¼š</p>
    <button id="test-api">æµ‹è¯•æµè§ˆå™¨API</button>
    <div id="api-result" class="info-box" style="display:none;"></div>
  </div>
  
  <h2>è§£å†³æ–¹æ³•</h2>
  <div class="info-box">
    <p>å¦‚æœæ‚¨æ— æ³•ç™»å½•ï¼Œè¯·å°è¯•ä»¥ä¸‹æ–¹æ³•ï¼š</p>
    <ol>
      <li>ä½¿ç”¨æµè§ˆå™¨çš„éšç§/æ— ç—•æ¨¡å¼ï¼ˆä¸åŠ è½½æ‰©å±•ï¼‰</li>
      <li>ä¸´æ—¶ç¦ç”¨æ‰€æœ‰æµè§ˆå™¨æ‰©å±•åé‡è¯•</li>
      <li>å°è¯•ä½¿ç”¨ä¸åŒçš„æµè§ˆå™¨ï¼ˆå¦‚Firefoxæˆ–Edgeï¼‰</li>
      <li>æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’ŒCookieåé‡è¯•</li>
    </ol>
  </div>
  
  <script>
    // æ˜¾ç¤ºæµè§ˆå™¨ä¿¡æ¯
    document.addEventListener('DOMContentLoaded', function() {
      var browserInfo = document.getElementById('browser-info');
      var userAgent = navigator.userAgent;
      var browserName = '';
      var browserVersion = '';
      
      if (userAgent.indexOf('Firefox') > -1) {
        browserName = 'Firefox';
        browserVersion = userAgent.match(/Firefox\/([0-9.]+)/)[1];
      } else if (userAgent.indexOf('Edge') > -1 || userAgent.indexOf('Edg') > -1) {
        browserName = 'Microsoft Edge';
        browserVersion = userAgent.match(/Edge\/([0-9.]+)/) || userAgent.match(/Edg\/([0-9.]+)/);
        browserVersion = browserVersion ? browserVersion[1] : '';
      } else if (userAgent.indexOf('Chrome') > -1) {
        browserName = 'Chrome';
        browserVersion = userAgent.match(/Chrome\/([0-9.]+)/)[1];
      } else if (userAgent.indexOf('Safari') > -1) {
        browserName = 'Safari';
        browserVersion = userAgent.match(/Safari\/([0-9.]+)/)[1];
      } else {
        browserName = 'æœªçŸ¥æµè§ˆå™¨';
      }
      
      browserInfo.innerHTML = `
        <strong>æµè§ˆå™¨:</strong> ${browserName} ${browserVersion}<br>
        <strong>æ“ä½œç³»ç»Ÿ:</strong> ${navigator.platform}<br>
        <strong>User Agent:</strong> ${userAgent}<br>
        <strong>Cookieå¯ç”¨:</strong> ${navigator.cookieEnabled ? 'æ˜¯' : 'å¦'}
      `;
    });
    
    // æµ‹è¯•æµè§ˆå™¨API
    document.getElementById('test-api').addEventListener('click', function() {
      var apiResult = document.getElementById('api-result');
      apiResult.style.display = 'block';
      
      try {
        // æµ‹è¯•localStorage
        localStorage.setItem('test', 'value');
        localStorage.removeItem('test');
        
        // æµ‹è¯•fetch API
        fetch('https://jsonplaceholder.typicode.com/todos/1')
          .then(response => {
            if (!response.ok) throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥');
            return response.json();
          })
          .then(data => {
            apiResult.innerHTML = 'âœ… æµè§ˆå™¨APIå·¥ä½œæ­£å¸¸ã€‚è¿™è¡¨æ˜æ‰©å±•å¯èƒ½æ²¡æœ‰é˜»æ­¢åŸºæœ¬åŠŸèƒ½ã€‚';
            apiResult.className = 'info-box success';
          })
          .catch(error => {
            apiResult.innerHTML = 'âŒ ç½‘ç»œAPIæµ‹è¯•å¤±è´¥: ' + error.message;
            apiResult.className = 'info-box error';
          });
      } catch (error) {
        apiResult.innerHTML = 'âŒ æµè§ˆå™¨APIæµ‹è¯•å¤±è´¥: ' + error.message;
        apiResult.className = 'info-box error';
      }
    });
  </script>
</body>
</html> 